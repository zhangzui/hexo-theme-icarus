---
title: 域名解析详解
date: 2018-11-22 23:40:44
categories:
    - DNS解析的全过程
tags:
  - 网络应用层
description: DNS解析的全过程，以及DNS服务器详解
---

域名解析就是我们常听到的DNS（Domain Name System），我们平时自己电脑上的网络配置信息都会有这一项，DNS服务器IP地址，手机连上网都会有DNS
配置项，一般我们都会选择自动的DNS服务器IP，那么我们思考DNS是如何帮助我们来解析域名和访问浏览网址的。
![](/images/thumbnail.18.jpg "")
<!--more-->

### 域名解析
我们知道ip地址通常是不好记忆的，所以我们通过域名去访问，DNS就是将这些域名转换成相应的IP地址，最终通过解析出来的公网IP，通过Nginx反向代理去真正的服务器获取资源，或者直接访问实际服务器。
在早期，网络中只有几百台机器，只需要通过一个Hosts文件就可以实现快速获取映射的IP，但是互联网发展至今，已经无法满足数亿的服务器资源访问。
后来，互联网只需要一台域名解析服务器，就能将域名解析工作搞定，但是在发展，依然无法满足，1983就因特网就采用层次树状的命名结构，并使用分布式域名系统。
所以DNS域名系统设计成了一个联机的分布式数据库，采用客户机和服务机的方式，大部分域名在本地就可以解析，少数需要访问公网上的域名系统。所以分布式的设计，使得单个计算机出现问题，也不会妨碍整个DNS的解析。
所以，当计算机某个应用程序需要域名解析，就可以调用本地的域名解析程序，把待解析的域名放在DNS请求报文中，以UDP的方式发给本地域名解析服务器，使用UDP是为了减少开销。
然后就可以获取相应的IP地址，如果本机没有应答，则本地域名解析服务器就会向互联网上另外一台域名服务器发出请求，直到找到相应的域名响应为止。

### 域名结构
层次树状结构：域名可以划分出子域名，子域名依然可以划分，所以就形成了顶级域，二级域，和三级域 等等。
DNS规定：域名中的标号由字母和数字构成，每个标号都不超过63个字符，但是为了方便记忆最好不要超过12个字符，而且不区分大小写，所以访问baidu.com和BAIDU.COM是一样的。
总的域名长度不超过255个字符。

### 顶级域名
(1) 国家顶级域名 nTLD：如: .cn 表示中国，.us 表示美国，.uk 表示英国，等等。
(2) 通用顶级域名 gTLD：最早的顶级域名有七个：
.com  （公司和企业）
.net  （网络服务机构）
.org  （非赢利性组织）
.edu  （美国专用的教育机构（）
.gov  （美国专用的政府部门）
.mil   （美国专用的军事部门）
.int     （国际组织）
（3）后续增加的顶级域名
    .aero （航空运输企业）
   .biz  （公司和企业）
   .cat   （加泰隆人的语言和文化团体）
   .coop  （合作团体）
   .info  （各种情况）
   .jobs  （人力资源管理者）
   .mobi  （移动产品与服务的用户和提供者）
   .museum  （博物馆）
   .name   （个人）
   .pro  （有证书的专业人员）
   .travel  （旅游业）
### 新顶级域名
机构或者企业可以根据自己的特性申请自己的新顶级域名，例如现在的域名申请出现了很多顶级域名，我的博客网站域名就是top的顶级域名。
机构申请这样的顶级域名也是需要一定的申请费。
注意：还有就是在国家顶级域名下注册二级域名由相应的国家自行规定，例如cn 国家顶级域名代表中国地区，二级域名可以是com,或者edu等
我国修订的域名体系已经允许公司或者机构直接注册二级域名，不需要代com，edu等。
例如国内做股票行情的网站：www.jrj.com.cn，同样可以直接申请为www.jrj.cn

### 反向域名解析

与通常的正向域名解析相反，只有一个顶级域名：即arpa，提供IP地址到域名的对应，反向域名格式如：X.X.X.in-addr.arpa。目前很多网络服务提供商要求访问的IP地址具有反向域名解析的结果，否则不提供服务。
反向域名解析系统(Reverse DNS)更重要的功能确保适当的邮件交换记录是生效的。这是一个最常见的问题（尤其是国外的邮件系统更是如此）。更多的电子邮件提供商是使用反向域名解析系统查找来确认信息是从哪里来的。由于这种方式的使用变得更广泛，那些没有正确地发布反向域名解析系统信息的域可能更常发生邮件的退回。
### 域名服务器

### 域名解析全流程

网上的一个DNS解析出现的坑，大家可以看一下，域名解析生效，和域名服务器更新需要时间，有的dns服务器更新不及时，可能导致域名解析不了导致无法访问，所以我们有时候公司内网默认的DNS解析出问题导致上不了网，可能就是DNS解析挂了，
所以我们平时会换掉DNS地址就可以解决。但是用户不一定会操作，还是小心谨慎为好。博客中是人员离职交接没有交接好，想到了其实还有很多，如果域名申请下来了，没有续费，导致域名被别人抢注就炸了
博客链接：[一次dns缓存引发的惨案](http://www.ityouknow.com/arch/2017/02/09/a-tragedy-caused-by-dns-cache.html "一次dns缓存引发的惨案")

第一步：浏览器将会检查缓存中有没有这个域名对应的解析过的IP地址，如果有该解析过程将会结束。浏览器缓存域名也是有限制的，包括缓存的时间、大小，可以通过TTL属性来设置。
第二步：如果用户的浏览器中缓存中没有，操作系统会先检查自己本地的hosts文件是否有这个网址映射关系，如果有，就先调用这个IP地址映射，完成域名解析。
第三步：如果hosts里没有这个域名的映射，则查找本地DNS解析器缓存，是否有这个网址映射关系，如果有，直接返回，完成域名解析。
第四步：如果hosts与本地DNS解析器缓存都没有相应的网址映射关系，首先会找TCP/ip参数中设置的首选DNS服务器，在此我们叫它本地DNS服务器，此服务器收到查询时，如果要查询的域名，包含在本地配置区域资源中，则返回解析结果给客户机，完成域名解析，此解析具有权威性。
第五步：如果要查询的域名，不由本地DNS服务器区域解析，但该服务器已缓存了此网址映射关系，则调用这个IP地址映射，完成域名解析，此解析不具有权威性。
第六步：如果本地DNS服务器本地区域文件与缓存解析都失效，则根据本地DNS服务器的设置（是否设置转发器）进行查询，如果未用转发模式，本地DNS就把请求发至13台根DNS，根DNS服务器收到请求后会判断这个域名(.com)是谁来授权管理，并会返回一个负责该顶级域名服务器的一个IP。本地DNS服务器收到IP信息后，将会联系负责.com域的这台服务器。这台负责.com域的服务器收到请求后，如果自己无法解析，它就会找一个管理.com域的下一级DNS服务器地址给本地DNS服务器。当本地DNS服务器收到这个地址后，就会找域名域服务器，重复上面的动作，进行查询，直至找到域名对应的主机。
第七步：如果用的是转发模式，此DNS服务器就会把请求转发至上一级DNS服务器，由上一级服务器进行解析，上一级服务器如果不能解析，或找根DNS或把转请求转至上上级，以此循环。不管是本地DNS服务器用是是转发，还是根提示，最后都是把结果返回给本地DNS服务器，由此DNS服务器再返回给客户机。


